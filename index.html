<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ì–æ—Ä–æ–¥–∞ —Å Dashboard –∏ Posts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React –∏ ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div id="root" class="w-full h-full max-w-6xl"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const cities = [
      { name: '–í–µ–Ω–∞', image: '/Static/Vienna.png' },
      { name: '–ü–∞—Ä–∏–∂', image: '/Static/Paris.png' },
      { name: '–ë–∞—Ä—Å–µ–ª–æ–Ω–∞', image: '/Static/Barcelona.png' },
      { name: '–ü—Ä–∞–≥–∞', image: '/Static/Prague.png' },
    ];

    const cityNameMap = {
      '–í–µ–Ω–∞': 'Vienna',
      '–ü–∞—Ä–∏–∂': 'Paris',
      '–ë–∞—Ä—Å–µ–ª–æ–Ω–∞': 'Barcelona',
      '–ü—Ä–∞–≥–∞': 'Prague',
    };

    const Sidebar = ({ currentPage, setCurrentPage, selectedCity, setSelectedCity }) => {
      const pages = ['Dashboard', 'Posts', 'Charts', 'Settings', 'Finance'];
      const [dropdownOpen, setDropdownOpen] = useState(false);

      return (
        <div className="w-36 bg-white h-full shadow-md flex flex-col p-4">
          <div className="mb-6 relative">
            <button
              onClick={() => setDropdownOpen(!dropdownOpen)}
              className="w-full flex justify-between items-center px-4 py-2 bg-gray-100 rounded cursor-pointer hover:bg-gray-200 transition"
            >
              <span className="font-semibold">{selectedCity}</span>
              <svg
                className={`w-5 h-5 transform transition-transform ${dropdownOpen ? 'rotate-180' : ''}`}
                fill="none" stroke="currentColor" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            {dropdownOpen && (
              <ul className="absolute left-0 right-0 bg-white border rounded shadow mt-1 z-10 max-h-48 overflow-auto">
                {cities.map(city => (
                  <li
                    key={city.name}
                    onClick={() => { setSelectedCity(city.name); setDropdownOpen(false); setCurrentPage('Dashboard'); }}
                    className="px-4 py-2 hover:bg-gray-100 cursor-pointer"
                  >
                    {city.name}
                  </li>
                ))}
              </ul>
            )}
          </div>

          <nav className="flex flex-col gap-2">
            {pages.map(page => (
              <button
                key={page}
                onClick={() => setCurrentPage(page)}
                className={`text-left py-2 px-4 rounded-lg hover:bg-gray-100 transition ${currentPage === page ? 'bg-gray-200 font-semibold' : ''}`}
              >
                {page}
              </button>
            ))}
          </nav>
        </div>
      );
    };

    const Dashboard = ({ city }) => {
      const [stats, setStats] = useState(null);
      const [error, setError] = useState(null);

      useEffect(() => {
        if (!city) return;

        const cityEng = cityNameMap[city] || city;

        fetch(`https://tgbot-production-1c7c.up.railway.app/api/city/${encodeURIComponent(cityEng)}`)
          .then(res => {
            if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            return res.json();
          })
          .then(data => {
            setStats([
              { label: '–ü–æ–¥–ø–∏—Å—á–∏–∫–∏', icon: 'üë•', value: data.subs },
              { label: '–ü–æ—Å—Ç—ã', icon: 'üìù', value: data.posts },
              { label: '–î–æ—Ö–æ–¥', icon: 'üí∞', value: data.income },
            ]);
            setError(null);
          })
          .catch(err => {
            setError(err.message);
            setStats(null);
          });
      }, [city]);

      if (error) return <div className="text-red-500">{error}</div>;
      if (!stats) return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>;

      return (
        <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
          {stats.map((stat) => (
            <div key={stat.label} className="bg-white rounded-xl p-4 flex items-center shadow">
              <div className="text-3xl mr-4">{stat.icon}</div>
              <div>
                <div className="text-sm text-gray-500">{stat.label}</div>
                <div className="text-xl font-bold">{stat.value}</div>
              </div>
            </div>
          ))}
        </div>
      );
    };

    const mockPosts = [
      { id: 1, title_ru: '–ü–æ—Å—Ç ‚Ññ1: –ù–æ–≤–æ—Å—Ç–∏ –í–µ–Ω—ã', approved: false, declined: false },
      { id: 2, title_ru: '–ü–æ—Å—Ç ‚Ññ2: –°–æ–±—ã—Ç–∏—è –≤ –ü–∞—Ä–∏–∂–µ', approved: false, declined: false },
      { id: 3, title_ru: '–ü–æ—Å—Ç ‚Ññ3: –ö—É–ª—å—Ç—É—Ä–∞ –ë–∞—Ä—Å–µ–ª–æ–Ω—ã', approved: false, declined: false },
    ];

    const Posts = () => {
      const [posts, setPosts] = useState(mockPosts);
      const [editingPost, setEditingPost] = useState(null);
      const [translatedText, setTranslatedText] = useState('');

      const declinePost = (id) => {
        setPosts(posts.map(p => p.id === id ? { ...p, declined: true } : p));
      };

      const approvePost = (post) => {
        setEditingPost(post);
        setTranslatedText(`–ü–µ—Ä–µ–≤–æ–¥ –ø–æ—Å—Ç–∞ "${post.title_ru}" (–∑–∞–≥–ª—É—à–∫–∞)`);
      };

      const publishPost = () => {
        setPosts(posts.filter(p => p.id !== editingPost.id));
        setEditingPost(null);
      };

      if (editingPost) {
        return (
          <div>
            <h2 className="text-xl font-bold mb-4">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞: {editingPost.title_ru}</h2>
            <textarea
              rows={10}
              className="w-full p-2 border rounded"
              value={translatedText}
              onChange={e => setTranslatedText(e.target.value)}
            />
            <div className="mt-4 flex gap-2">
              <button
                className="bg-green-500 text-white px-4 py-2 rounded"
                onClick={publishPost}
              >
                –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É
              </button>
              <button
                className="bg-gray-300 px-4 py-2 rounded"
                onClick={() => setEditingPost(null)}
              >
                –û—Ç–º–µ–Ω–∞
              </button>
            </div>
          </div>
        );
      }

      return (
        <div>
          <h2 className="text-xl font-bold mb-4">–ù–æ–≤—ã–µ –ø–æ—Å—Ç—ã –∑–∞ 24 —á–∞—Å–∞</h2>
          {posts.filter(p => !p.declined).length === 0 && <div>–ù–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤ –Ω–µ—Ç</div>}
          <ul>
            {posts.filter(p => !p.declined).map(post => (
              <li
                key={post.id}
                className="mb-3 p-3 bg-white rounded shadow flex justify-between items-center"
              >
                <div>{post.title_ru}</div>
                <div className="flex gap-2">
                  <button
                    className="bg-green-500 text-white px-3 py-1 rounded"
                    title="–ê–ø—Ä—É–≤"
                    onClick={() => approvePost(post)}
                  >
                    ‚úî
                  </button>
                  <button
                    className="bg-red-500 text-white px-3 py-1 rounded"
                    title="–î–µ–∫–ª–∞–π–Ω"
                    onClick={() => declinePost(post.id)}
                  >
                    ‚úñ
                  </button>
                </div>
              </li>
            ))}
          </ul>
        </div>
      );
    };

    const Placeholder = ({ title }) => (
      <div className="text-xl text-gray-600 font-semibold">{title} —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</div>
    );

    // –ù–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Settings —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ –≥–æ—Ä–æ–¥–∞–º
    const Settings = ({ city }) => {
      const initialSettings = {
        –í–µ–Ω–∞: [
          { id: 1, name: '–ù–∞–∑–≤–∞–Ω–∏–µ 1', enabled: true },
          { id: 2, name: '–ù–∞–∑–≤–∞–Ω–∏–µ 2', enabled: false },
          { id: 3, name: '–ù–∞–∑–≤–∞–Ω–∏–µ 3', enabled: true },
        ],
        –ü–∞—Ä–∏–∂: [
          { id: 1, name: '–ù–∞–∑–≤–∞–Ω–∏–µ A', enabled: false },
          { id: 2, name: '–ù–∞–∑–≤–∞–Ω–∏–µ B', enabled: true },
          { id: 3, name: '–ù–∞–∑–≤–∞–Ω–∏–µ C', enabled: false },
        ],
        –ë–∞—Ä—Å–µ–ª–æ–Ω–∞: [
          { id: 1, name: '–ù–∞–∑–≤–∞–Ω–∏–µ X', enabled: true },
          { id: 2, name: '–ù–∞–∑–≤–∞–Ω–∏–µ Y', enabled: true },
          { id: 3, name: '–ù–∞–∑–≤–∞–Ω–∏–µ Z', enabled: false },
        ],
        –ü—Ä–∞–≥–∞: [
          { id: 1, name: '–ù–∞–∑–≤–∞–Ω–∏–µ Œ±', enabled: false },
          { id: 2, name: '–ù–∞–∑–≤–∞–Ω–∏–µ Œ≤', enabled: false },
          { id: 3, name: '–ù–∞–∑–≤–∞–Ω–∏–µ Œ≥', enabled: true },
        ],
      };

      const [settingsByCity, setSettingsByCity] = useState(initialSettings);

      const toggleSetting = (cityName, id) => {
        setSettingsByCity((prev) => ({
          ...prev,
          [cityName]: prev[cityName].map((s) =>
            s.id === id ? { ...s, enabled: !s.enabled } : s
          ),
        }));
      };

      const changeName = (cityName, id, newName) => {
        setSettingsByCity((prev) => ({
          ...prev,
          [cityName]: prev[cityName].map((s) =>
            s.id === id ? { ...s, name: newName } : s
          ),
        }));
      };

      const citySettings = settingsByCity[city] || [];

      return (
        <div className="max-w-md bg-white p-6 rounded shadow space-y-4">
          <h2 className="text-xl font-semibold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≥–æ—Ä–æ–¥–∞: {city}</h2>
          {citySettings.length === 0 && <div>–ù–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è —ç—Ç–æ–≥–æ –≥–æ—Ä–æ–¥–∞</div>}
          {citySettings.map(({ id, name, enabled }) => (
            <div key={id} className="flex items-center justify-between gap-4">
              <input
                type="text"
                className="border rounded px-2 py-1 flex-1"
                value={name}
                onChange={(e) => changeName(city, id, e.target.value)}
              />
              <label className="inline-flex relative items-center cursor-pointer">
                <input
                  type="checkbox"
                  className="sr-only peer"
                  checked={enabled}
                  onChange={() => toggleSetting(city, id)}
                />
                <div className="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-blue-600 transition"></div>
                <div
                  className={`absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-5`}
                ></div>
              </label>
            </div>
          ))}
        </div>
      );
    };

    const App = () => {
      const [currentPage, setCurrentPage] = useState('Dashboard');
      const [selectedCity, setSelectedCity] = useState('–í–µ–Ω–∞');

      return (
        <div className="flex max-w-7xl w-full h-[90vh] bg-white rounded-lg shadow overflow-hidden">
          <Sidebar
            currentPage={currentPage}
            setCurrentPage={setCurrentPage}
            selectedCity={selectedCity}
            setSelectedCity={setSelectedCity}
          />
          <main className="flex-1 p-6 overflow-auto">
            {currentPage === 'Dashboard' && <Dashboard city={selectedCity} />}
            {currentPage === 'Posts' && <Posts />}
            {currentPage === 'Charts' && <Placeholder title="Charts" />}
            {currentPage === 'Settings' && <Settings city={selectedCity} />}
            {currentPage === 'Finance' && <Placeholder title="Finance" />}
          </main>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
